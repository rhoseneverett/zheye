import{d as b,c as p,a as c,b as e,t as m,o as n,B as S,l as k,h as d,v as T,T as B,z as L,j as N,M as U,k as h,g as V,e as y,w as g,i as A,y as D,f as I,m as R,n as j}from"./index-DyRkbYjn.js";import{a as E}from"./helper-TXTB4Bdo.js";import{u as H}from"./post-BMlZJ4gU.js";const O={class:"user-profile-component"},z={class:"d-flex align-items-center"},q=["src","alt"],F={class:"detail ml-2"},G={class:"d-block mb-0"},J={class:"text-truncate text-muted d-block"},K=b({__name:"UserProfile",props:{user:{}},setup(l){const o=l,r=p(()=>{E(o.user,50,50);const{avatar:s}=o.user;return s&&s.fitUrl});return(s,u)=>(n(),c("div",O,[e("div",z,[e("img",{src:r.value,alt:s.user.nickName,class:"rounded-circle img-thumbnail"},null,8,q),e("div",F,[e("h6",G,m(s.user.nickName),1),e("span",J,m(s.user.description),1)])])]))}});function Q(l){const o=document.createElement("div");o.id=l,document.body.appendChild(o),S(()=>{document.body.removeChild(o)})}const W={key:0,class:"modal d-block",tabindex:"-1"},X={class:"modal-dialog"},Y={class:"modal-content"},Z={class:"modal-header d-flex justify-content-between"},ee={class:"modal-title"},te={class:"modal-body"},se=b({__name:"Modal",props:{title:String,visible:{type:Boolean,default:!1}},emits:["modal-on-close","modal-on-confirm"],setup(l,{emit:o}){const r=o;Q("modal");const s=()=>{r("modal-on-close")},u=()=>{r("modal-on-confirm")};return(v,t)=>(n(),k(B,{to:"#modal"},[l.visible?(n(),c("div",W,[e("div",X,[e("div",Y,[e("div",Z,[e("h5",ee,m(l.title),1),e("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"},[e("span",{"aria-hidden":"true",onClick:s},"×")])]),e("div",te,[T(v.$slots,"default")]),e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal",onClick:s},"取消"),e("button",{type:"button",class:"btn btn-primary",onClick:u},"确定")])])])])):d("",!0)]))}}),oe={class:"post-detail-page"},ae={key:0,class:"w-75 mx-auto mb-5 pb-3"},ne=["src"],le={class:"mb-4"},re={class:"user-profile-component border-top border-bottom py-3 mb-5 align-items-center row g-0"},ie={class:"col"},ce={class:"text-muted col text-right font-italic"},ue=["innerHTML"],de={key:1,class:"btn-group mt-5"},ve=b({__name:"PostDetail",setup(l){const r=L().params.id,s=H(),u=N(),v=new U,t=h(null);V(async()=>{t.value=await s.fetchPost(r)});const C=p(()=>t.value&&t.value.excerpt?v.render(t.value.excerpt):""),f=p(()=>{if(t.value&&t.value.image){const{image:i}=t.value;return i.url+"?x-oss-process=image/resize,w_850"}return null}),$=p(()=>{var i;return t.value&&t.value.author&&u.isLogin?t.value.author._id===((i=u.data)==null?void 0:i._id):!1}),_=h(!1),w=R(),x=async()=>{_.value=!1;const i=await s.deletePost(r);j("删除成功，2秒后跳转到专栏首页","success",2e3),setTimeout(()=>{w.push({name:"column",params:{id:i.column}})},2e3)};return(i,a)=>{const M=A("RouterLink");return n(),c("div",oe,[y(se,{title:"删除文章",visible:_.value,onModalOnClose:a[0]||(a[0]=P=>_.value=!1),onModalOnConfirm:x},{default:g(()=>a[2]||(a[2]=[e("p",null,"确定要删除这篇文章吗？",-1)])),_:1},8,["visible"]),t.value?(n(),c("article",ae,[f.value?(n(),c("img",{key:0,src:f.value,alt:"currentPost.title",class:"rounded-lg img-fluid my-4"},null,8,ne)):d("",!0),e("h2",le,m(t.value.title),1),e("div",re,[e("div",ie,[typeof t.value.author=="object"?(n(),k(K,{key:0,user:t.value.author},null,8,["user"])):d("",!0)]),e("span",ce,"发表于："+m(t.value.createdAt),1)]),e("div",{innerHTML:C.value},null,8,ue),$.value?(n(),c("div",de,[y(M,{type:"button",class:"btn btn-success",to:{name:"create",query:{id:t.value._id}}},{default:g(()=>a[3]||(a[3]=[I(" 编辑 ")])),_:1},8,["to"]),e("button",{type:"button",class:"btn btn-danger",onClick:a[1]||(a[1]=D(P=>_.value=!0,["prevent"]))},"删除")])):d("",!0)])):d("",!0)])}}});export{ve as default};
